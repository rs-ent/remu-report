(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[995],{29995:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return x}});var r=a(57437),n=a(2265),s=a(24033),l=a(46618);a(70551);var o=t=>{let{data:e}=t,a=(0,n.useRef)(null),[s,o]=(0,n.useState)({width:0,height:0});(0,n.useEffect)(()=>{let t=new ResizeObserver(t=>{if(!t||0===t.length)return;let{width:e}=t[0].contentRect;e>600&&(e=600),o({width:e,height:400})});return a.current&&a.current.parentElement&&t.observe(a.current.parentElement),()=>{a.current&&a.current.parentElement&&t.unobserve(a.current.parentElement)}},[]);let c=(0,n.useMemo)(()=>{if(!e||0===e.length)return[];let t=[...e].sort((t,e)=>l.j2p(t.date,e.date)),a=[];for(let e=1;e<t.length;e++){let r=t[e],n=r.salesGrowth;a.push({date:r.date,totalGrowth:n,totalSales:r.averageSales})}return console.log("Growth Rate: ",a),a},[e]),i=t=>t>=1e12?(t/1e12).toFixed(1)+"조":t>=1e8?(t/1e8).toFixed(1)+"억":t>=1e7?(t/1e7).toFixed(1)+"천만":t>=1e6?(t/1e6).toFixed(1)+"백만":t>=1e5?(t/1e5).toFixed(1)+"십만":t>=1e4?(t/1e4).toFixed(1)+"만":t.toString();return(0,n.useEffect)(()=>{var t;if(!a.current||0===c.length)return;let e=l.Ys(a.current),{width:r,height:n}=s;if(0===r||0===n)return;let o={top:20,right:60,bottom:35,left:40},d={background:"transparent",grid:"#e0e0e0",growthLine:"#ff6b6b",salesBar:"#81afd4"},m=l.tiA().domain(c.map(t=>t.date)).range([o.left,r-o.right]).padding(.1),h=null!==(t=l.VV$(c,t=>t.totalGrowth))&&void 0!==t?t:-20,u=l.BYU().domain([Math.min(h-5,-30),l.Fp7(c,t=>t.totalGrowth)+5]).nice().range([n-o.bottom,o.top]),p=l.BYU().domain([0,l.Fp7(c,t=>1.1*t.totalSales)]).nice().range([n-o.bottom,o.top]);e.selectAll("*").remove(),e.attr("width",r).attr("height",n).style("background",d.background),e.append("g").attr("class","grid").attr("transform","translate(0,0)").call(l.y4O(u).ticks(5).tickSize(-r+o.left+o.right).tickFormat(()=>"")).selectAll("line").attr("stroke",d.grid).attr("transform","translate(".concat(o.left,",0)"));let g=e.append("g").attr("transform","translate(0,".concat(n-o.bottom,")")).call(l.LLu(m));g.selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end").attr("dx","-0.5em").attr("dy","0.1em"),e.append("g").attr("transform","translate(".concat(o.left,",0)")).call(l.y4O(u).ticks(5).tickFormat(t=>"".concat(t,"%"))),e.append("g").attr("transform","translate(".concat(r-o.right,",0)")).call(l.Khx(p).ticks(5).tickFormat(t=>i(t))),e.selectAll(".bar").data(c).enter().append("rect").attr("class","bar").attr("x",t=>m(t.date)).attr("width",m.bandwidth()).attr("y",t=>p(0)).attr("height",0).attr("fill",d.salesBar).on("mouseover",function(t,e){l.Ys(this).attr("fill",l.B8C(d.salesBar).darker(1).toString()),x.style("opacity",1).html("<strong>".concat(e.date,"</strong><br/>Sales: ").concat(i(e.totalSales),"원<br/>Growth Rate: ").concat(e.totalGrowth.toFixed(2),"%")).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(){l.Ys(this).attr("fill",d.salesBar),x.style("opacity",0)}).transition().duration(800).attr("y",t=>p(t.totalSales)).attr("height",t=>n-o.bottom-p(t.totalSales));let f=l.jvg().x(t=>m(t.date)+m.bandwidth()/2).y(t=>u(t.totalGrowth)).curve(l.FdL);e.append("path").datum(c).attr("fill","none").attr("stroke",d.growthLine).attr("stroke-width",3).attr("d",f),e.selectAll(".dot").data(c).enter().append("circle").attr("class","dot").attr("cx",t=>m(t.date)+m.bandwidth()/2).attr("cy",t=>u(t.totalGrowth)).attr("r",0).attr("fill",d.growthLine).on("mouseover",function(t,e){l.Ys(this).transition().duration(200).attr("r",8),x.style("opacity",1).html("<strong>".concat(e.date,"</strong><br/>Growth Rate: ").concat(e.totalGrowth.toFixed(2),"%<br/>Sales: ").concat(i(e.totalSales),"원")).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(){l.Ys(this).transition().duration(200).attr("r",5),x.style("opacity",0)}).transition().duration(800).attr("r",5);let x=l.Ys("body").append("div").attr("class","chart-tooltip").style("opacity",0);return()=>{e.selectAll("*").remove(),x.remove()}},[c,s]),(0,r.jsx)("div",{className:"chart-container",children:(0,r.jsx)("svg",{ref:a})})},c=a(24086),i=a(72420);let d=async()=>{let t=(0,c.hJ)(i.db,"MarketGrowth"),e=await (0,c.PL)(t),a=[];return e.forEach(t=>{let e=t.data();a.push({id:t.id,company:e.company,date:e.date.toString(),sales:e.sales,sales_contents:e.sales_contents,sales_music:e.sales_music,sales_management:e.sales_management})}),a},m=async()=>{let t=(0,c.hJ)(i.db,"AutoComments");try{let e=await (0,c.PL)((0,c.IO)(t,(0,c.Xo)("timestamp","desc"),(0,c.b9)(1)));if(e.empty)return console.warn("No AutoComments found."),null;{let t=e.docs[0],a=t.data().comments;return{comment_openai:a.comment_openai,detail_comment_openai:a.detail_comment_openai}}}catch(t){return console.error("Failed to fetch the latest AutoComment:",t),null}};var h=a(8411),u=a(55592);a(61486);var p=t=>{let{data:e,title:a}=t,s=(0,n.useRef)(null),[o,c]=(0,n.useState)({width:600,height:400});(0,n.useEffect)(()=>{let t=()=>{var t;let e=null===(t=s.current)||void 0===t?void 0:t.parentElement;if(e){let t=e.clientWidth>800?800:e.clientWidth;c({width:t,height:300})}};return window.addEventListener("resize",t),t(),()=>{window.removeEventListener("resize",t)}},[]);let i=(0,n.useMemo)(()=>e.map(t=>({date:t.date,musicSales:t.averageMusicSales,musicGrowth:t.musicSalesGrowth,contentsSales:t.averageContentsSales,contentsGrowth:t.contentsSalesGrowth,managementSales:t.averageManagementSales,managementGrowth:t.managementSalesGrowth})),[e]),d=t=>t>=1e12?(t/1e12).toFixed(1)+"조":t>=1e8?(t/1e8).toFixed(1)+"억":t>=1e7?(t/1e7).toFixed(1)+"천만":t>=1e6?(t/1e6).toFixed(1)+"백만":t>=1e5?(t/1e5).toFixed(1)+"십만":t>=1e4?(t/1e4).toFixed(1)+"만":t.toString();return(0,n.useEffect)(()=>{if(!s.current||0===i.length)return;let t=l.Ys(s.current),{width:e,height:a}=o,r={top:40,right:80,bottom:45,left:60},n={musicSales:"#ffab00",contentsSales:"#00c853",managementSales:"#d500f9",musicGrowth:"#ff6b6b",contentsGrowth:"#00acc1",managementGrowth:"#8e24aa",grid:"#e0e0e0",tooltipBg:"#ffffff",tooltipText:"#333333"},c=l.tiA().domain(i.map(t=>t.date)).range([r.left,e-r.right]).padding(.2),m=l.BYU().domain([0,1.1*l.Fp7(i,t=>Math.max(t.musicSales,t.contentsSales,t.managementSales))]).nice().range([a-r.bottom,r.top]),h=l.BYU().domain([l.VV$(i,t=>Math.min(t.musicGrowth,t.contentsGrowth,t.managementGrowth))-5,l.Fp7(i,t=>Math.max(t.musicGrowth,t.contentsGrowth,t.managementGrowth))+5]).nice().range([a-r.bottom,r.top]);t.selectAll("*").remove(),t.attr("width",e).attr("height",a).style("background","transparent"),t.append("g").attr("class","grid").attr("transform","translate(".concat(r.left,",0)")).call(l.y4O(m).ticks(5).tickSize(-e+r.left+r.right).tickFormat(()=>"")).selectAll("line").attr("stroke",n.grid);let u=t.append("g").attr("transform","translate(0,".concat(a-r.bottom,")")).call(l.LLu(c));u.selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end").attr("dx","-0.5em").attr("dy","0.1em"),t.append("g").attr("transform","translate(".concat(e-r.right,",0)")).call(l.Khx(m).ticks(5).tickFormat(t=>d(t))),t.append("g").attr("transform","translate(".concat(r.left,",0)")).call(l.y4O(h).ticks(5).tickFormat(t=>"".concat(t,"%"))),t.selectAll(".bar-music").data(i).enter().append("rect").attr("class","bar-music").attr("x",t=>c(t.date)).attr("width",c.bandwidth()/3).attr("y",m(0)).attr("height",0).attr("fill",n.musicSales).on("mouseover",function(t,e){l.Ys(this).attr("fill",l.B8C(n.musicSales).darker(1).toString()),x.style("opacity",1).html("<strong>".concat(e.date,"</strong><br/>음원/음반 : ").concat(d(e.musicSales),"원")).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(){l.Ys(this).attr("fill",n.musicSales),x.style("opacity",0)}).transition().duration(800).attr("y",t=>m(t.musicSales)).attr("height",t=>a-r.bottom-m(t.musicSales)),t.selectAll(".bar-contents").data(i).enter().append("rect").attr("class","bar-contents").attr("x",t=>c(t.date)+c.bandwidth()/3).attr("width",c.bandwidth()/3).attr("y",m(0)).attr("height",0).attr("fill",n.contentsSales).on("mouseover",function(t,e){l.Ys(this).attr("fill",l.B8C(n.contentsSales).darker(1).toString()),x.style("opacity",1).html("<strong>".concat(e.date,"</strong><br/>공연/콘텐츠 : ").concat(d(e.contentsSales),"원")).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(){l.Ys(this).attr("fill",n.contentsSales),x.style("opacity",0)}).transition().duration(800).attr("y",t=>m(t.contentsSales)).attr("height",t=>a-r.bottom-m(t.contentsSales)),t.selectAll(".bar-management").data(i).enter().append("rect").attr("class","bar-management").attr("x",t=>c(t.date)+2*c.bandwidth()/3).attr("width",c.bandwidth()/3).attr("y",m(0)).attr("height",0).attr("fill",n.managementSales).on("mouseover",function(t,e){l.Ys(this).attr("fill",l.B8C(n.managementSales).darker(1).toString()),x.style("opacity",1).html("<strong>".concat(e.date,"</strong><br/>출연료/초상권 : ").concat(d(e.managementSales),"원")).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(){l.Ys(this).attr("fill",n.managementSales),x.style("opacity",0)}).transition().duration(800).attr("y",t=>m(t.managementSales)).attr("height",t=>a-r.bottom-m(t.managementSales));let p=l.jvg().x(t=>c(t.date)+c.bandwidth()/2).y(t=>h(t.musicGrowth)).curve(l.FdL),g=l.jvg().x(t=>c(t.date)+c.bandwidth()/2).y(t=>h(t.contentsGrowth)).curve(l.FdL),f=l.jvg().x(t=>c(t.date)+c.bandwidth()/2).y(t=>h(t.managementGrowth)).curve(l.FdL);t.append("path").datum(i).attr("fill","none").attr("stroke",n.musicGrowth).attr("stroke-width",2).attr("d",p),t.append("path").datum(i).attr("fill","none").attr("stroke",n.contentsGrowth).attr("stroke-width",2).attr("d",g),t.append("path").datum(i).attr("fill","none").attr("stroke",n.managementGrowth).attr("stroke-width",2).attr("d",f),t.selectAll(".dot-music").data(i).enter().append("circle").attr("class","dot-music").attr("cx",t=>c(t.date)+c.bandwidth()/2).attr("cy",t=>h(t.musicGrowth)).attr("r",4).attr("fill",n.musicGrowth).on("mouseover",function(t,e){l.Ys(this).attr("r",6),x.style("opacity",1).html("<strong>".concat(e.date,"</strong><br/>음원/음반 성장률: ").concat(e.musicGrowth.toFixed(2),"%")).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(){l.Ys(this).attr("r",4),x.style("opacity",0)}),t.selectAll(".dot-contents").data(i).enter().append("circle").attr("class","dot-contents").attr("cx",t=>c(t.date)+c.bandwidth()/2).attr("cy",t=>h(t.contentsGrowth)).attr("r",4).attr("fill",n.contentsGrowth).on("mouseover",function(t,e){l.Ys(this).attr("r",6),x.style("opacity",1).html("<strong>".concat(e.date,"</strong><br/>공연/콘텐츠 성장률: ").concat(e.contentsGrowth.toFixed(2),"%")).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(){l.Ys(this).attr("r",4),x.style("opacity",0)}),t.selectAll(".dot-management").data(i).enter().append("circle").attr("class","dot-management").attr("cx",t=>c(t.date)+c.bandwidth()/2).attr("cy",t=>h(t.managementGrowth)).attr("r",4).attr("fill",n.managementGrowth).on("mouseover",function(t,e){l.Ys(this).attr("r",6),x.style("opacity",1).html("<strong>".concat(e.date,"</strong><br/>출연료/초상권 성장률: ").concat(e.managementGrowth.toFixed(2),"%")).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(){l.Ys(this).attr("r",4),x.style("opacity",0)});let x=l.Ys("body").append("div").attr("class","chart-tooltip").style("opacity",0).style("position","absolute").style("background",n.tooltipBg).style("color",n.tooltipText).style("padding","8px").style("border","1px solid #ccc").style("border-radius","4px").style("pointer-events","none");return()=>{t.selectAll("*").remove(),x.remove()}},[i,o]),(0,r.jsxs)("div",{className:"chart-container",children:[(0,r.jsx)("h3",{className:"chart-title",children:a}),(0,r.jsx)("svg",{ref:s})]})},g=t=>{let{auto_comment:e,data:a}=t;return(0,r.jsxs)("div",{className:"w-full flex flex-col items-center mt-8 space-y-8",children:[(0,r.jsx)("div",{className:"w-full max-w-2xl text-center",children:(0,r.jsx)(p,{data:a,title:"세부 매출 및 성장률 현황"})}),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"mt-1 w-full max-w-xl relative",children:[e&&(0,r.jsx)("p",{className:"text-xs text-gray-400 mb-2 text-center font-extralight",children:e}),(0,r.jsx)(u.Z,{commentKey:"macro_marketGrowthDetail_comment"})]})})]})},f=()=>{let[t,e]=(0,n.useState)([]),[a,s]=(0,n.useState)(!0),[l,c]=(0,n.useState)(null),[i,p]=(0,n.useState)(null);(0,n.useEffect)(()=>{let t=async()=>{try{let t=await d(),a=f(t);console.log("Average Sales Data : ",a),e(a);let r=await m();console.log("Auto Comments : ",r),p(r)}catch(t){c("데이터를 불러오는 데 실패했습니다.")}finally{s(!1)}};t()},[]);let f=t=>{let e=t.reduce((t,e)=>(t[e.date]||(t[e.date]=[]),t[e.date].push(e),t),{}),a=Object.keys(e).sort(),r=a.map((t,r)=>{let n=e[t],s=n.reduce((t,e)=>t+e.sales,0),l=s/n.length,o=n.reduce((t,e)=>t+(e.sales_music||0),0),c=o/n.length,i=n.reduce((t,e)=>t+(e.sales_contents||0),0),d=i/n.length,m=n.reduce((t,e)=>t+(e.sales_management||0),0),h=m/n.length,u=0,p=0,g=0,f=0;if(r>0){let t=a[r-1],n=e[t],s=n.reduce((t,e)=>t+e.sales,0)/n.length;u=(l-s)/s*100;let o=n.reduce((t,e)=>t+(e.sales_music||0),0)/n.length;p=(c-o)/o*100;let i=n.reduce((t,e)=>t+(e.sales_contents||0),0)/n.length;g=(d-i)/i*100;let m=n.reduce((t,e)=>t+(e.sales_management||0),0)/n.length;f=(h-m)/m*100}return{id:t,company:"any",date:t,sales:s,sales_music:o,sales_contents:i,sales_management:m,averageSales:l,salesGrowth:u,averageMusicSales:c,musicSalesGrowth:p,averageContentsSales:d,contentsSalesGrowth:g,averageManagementSales:h,managementSalesGrowth:f}});return r};return a?(0,r.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,r.jsx)(h.Z,{}),(0,r.jsx)("p",{className:"ml-4 text-gray-500",children:"데이터를 불러오는 중입니다..."})]}):l?(0,r.jsxs)("div",{className:"text-center text-red-500",children:[l," ",(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"ml-2 text-blue-500",children:"재시도"})]}):(0,r.jsxs)("div",{className:"w-full flex flex-col items-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-1 text-primary",children:"시장 성장률"}),t.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"w-full max-w-xl",children:[(0,r.jsx)(o,{data:t}),(0,r.jsxs)("div",{className:"mt-2 w-full max-w-xl relative",children:[i&&(0,r.jsx)("p",{className:"text-xs text-gray-400 mb-2 text-center font-extralight",children:i.comment_openai}),(0,r.jsx)(u.Z,{commentKey:"macro_marketGrowth_comment"})]})]}),(0,r.jsx)(g,{auto_comment:null==i?void 0:i.detail_comment_openai,data:t})]}):(0,r.jsx)("p",{className:"text-center text-gray-500",children:"시장 성장 데이터가 없습니다."})]})},x=()=>{let{artist_eng:t}=(0,s.useParams)();return(0,r.jsx)("div",{className:"w-full flex flex-col items-center",children:(0,r.jsx)(f,{})})}},70551:function(){},61486:function(){}}]);