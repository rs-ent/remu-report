"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[354],{40354:function(t,e,a){a.r(e),a.d(e,{default:function(){return w}});var r=a(57437),s=a(2265),l=a(24086),i=a(72420);let n=t=>{if(t.startsWith("https://circlechart.kr/uploadDir/"))return t;let e=t.split("thumb/");return"https://circlechart.kr/uploadDir/albumImg/thumb/".concat(e[1])},o=async t=>{let e=(0,l.hJ)(i.db,"CircleCharts"),a=(0,l.IO)(e,(0,l.ar)("target","==",t)),r=await (0,l.PL)(a),s=r.docs[0];if(!s)return null;let o=s.data();return{id:s.id,target:o.target,timestamp:o.timestamp,global_chart:o.global.map(t=>({album:t.album,album_img:n(t.album_img),artist:t.artist,distribution:t.distribution,melon_album_id:t.melon_album_id,melon_album_url:t.melon_album_url,production:t.production,rank:t.rank,rank_status:t.rank_status,seq_mom:t.seq_mom,title:t.title})),streaming_chart:o.streaming.map(t=>({album:t.album,album_img:n(t.album_img),artist:t.artist,distribution:t.distribution,melon_album_id:t.melon_album_id,melon_album_url:t.melon_album_url,production:t.production,rank:t.rank,rank_status:t.rank_status,seq_mom:t.seq_mom,title:t.title})),retail_chart:o.retail.map(t=>({album:t.album,album_img:n(t.album_img),artist:t.artist,distribution:t.distribution,melon_album_id:t.melon_album_id,melon_album_url:t.melon_album_url,production:t.production,rank:t.rank,rank_status:t.rank_status,seq_mom:t.seq_mom,title:t.title}))}};var c=t=>{let{target:e,global:a,streaming:l,retail:i}=t,[n,o]=(0,s.useState)(null),c=t=>{o(t)},m=t=>Array.isArray(t)?t.join(", "):t,u=function(t,e,a){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,r.jsxs)("div",{className:"w-full lg:w-1/3 px-4",children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("h3",{className:"text-lg font-semibold ".concat(a," p-2 rounded-md text-white text-center"),children:e})}),(0,r.jsx)("div",{className:"max-h-80 overflow-y-auto",children:(0,r.jsx)("table",{className:"w-full table-fixed",children:(0,r.jsx)("tbody",{children:t.sort((t,e)=>t.rank-e.rank).slice(0,100).map((t,e)=>(0,r.jsxs)("tr",{className:"cursor-pointer hover:bg-gray-200 transition-colors duration-200",onClick:()=>c(t),children:[(0,r.jsx)("td",{className:"px-1 py-2 w-8 text-center",children:t.rank}),(0,r.jsx)("td",{className:"px-1 py-2 w-16",children:(0,r.jsx)("img",{src:t.album_img,alt:t.album,className:"w-10 h-10 object-cover rounded-md"})}),(0,r.jsx)("td",{className:"px-1 py-2 truncate",children:s?t.album:t.title}),(0,r.jsx)("td",{className:"px-1 py-2 text-xs text-gray-500 truncate",children:m(t.artist)})]},e))})})})]})};return(0,r.jsxs)("div",{className:"max-w-7xl mx-auto p-6",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100 mb-4 text-center",children:"Circle Charts Data"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6 text-center",children:["※ 써클차트 데이터 (",e.slice(0,4),".",e.slice(4),")"]}),(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row space-y-8 lg:space-y-0 lg:space-x-1",children:[u(a,"Global Chart","bg-gray-800"),u(l,"Streaming Chart","bg-blue-500"),u(i,"Retail Chart","bg-green-500",!0)]}),n&&(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50 transition-opacity duration-300",onClick:()=>o(null),children:(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-900 rounded-lg shadow-2xl p-8 w-96 relative transform transition-transform duration-300 scale-105 hover:scale-100",onClick:t=>t.stopPropagation(),children:[(0,r.jsx)("button",{className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors duration-200",onClick:()=>o(null),children:"✕"}),(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["Rank: ",(0,r.jsx)("span",{className:"font-bold",children:n.rank})," (",n.rank_status,")"]}),(0,r.jsx)("img",{src:n.album_img,alt:n.album,className:"w-32 h-32 object-cover rounded-lg mx-auto shadow-md transform transition-transform duration-300 hover:scale-105"})]}),(0,r.jsx)("h4",{className:"text-2xl font-extrabold text-center mb-2 text-gray-800 dark:text-gray-100",children:n.title}),(0,r.jsxs)("div",{className:"flex flex-col items-center text-gray-700 dark:text-gray-300 space-y-2",children:[n.album&&(0,r.jsxs)("p",{className:"text-sm",children:["Album: ",(0,r.jsx)("span",{className:"font-semibold",children:n.album})]}),n.artist&&(0,r.jsxs)("p",{className:"text-sm",children:["Artists: ",(0,r.jsx)("span",{className:"font-semibold",children:m(n.artist)})]}),n.production&&n.production.length>0&&(0,r.jsxs)("p",{className:"text-sm",children:["Production: ",(0,r.jsx)("span",{className:"font-semibold",children:n.production.join(", ")})]}),n.distribution&&n.distribution.length>0&&(0,r.jsxs)("p",{className:"text-sm",children:["Distribution: ",(0,r.jsx)("span",{className:"font-semibold",children:n.distribution.join(", ")})]})]})]})})]})};let m=async t=>{let e=(0,l.hJ)(i.db,"songs"),a=(0,l.IO)(e,(0,l.ar)("artist_id","==",t)),r=await (0,l.PL)(a);return r.docs.map(t=>{let e=t.data();return{album:e.album,album_id:e.album_id,album_title:e.album_title,artist_id:e.artist_id,artist_name:e.artist_name,creators:e.creators,flac_info:e.flac_info,genre:e.genre,hearts:e.hearts,listeners:e.listeners,lyrics:e.lyrics,related_videos:e.related_videos,release_date:e.release_date,released_date:e.released_date,song_id:e.song_id,song_title:e.song_title,spotify_album_image_url:e.spotify_album_image_url,spotify_album_name:e.spotify_album_name,spotify_album_release_date:e.spotify_album_release_date,spotify_album_total_tracks:e.spotify_album_total_tracks,spotify_album_url:e.spotify_album_url,spotify_artists:e.spotify_artists,spotify_audio_features:e.spotify_audio_features,spotify_id:e.spotify_id,spotify_isrc:e.spotify_isrc,spotify_popularity:e.spotify_popularity,spotify_preview_url:e.spotify_preview_url,spotify_track_duration_ms:e.spotify_track_duration_ms,spotify_track_name:e.spotify_track_name,spotify_track_number:e.spotify_track_number,spotify_track_url:e.spotify_track_url,streams:e.streams,timestamp:e.timestamp}})},u=async t=>{let e=(0,l.hJ)(i.db,"songs"),a=(0,l.IO)(e,(0,l.ar)("album_id","==",t)),r=await (0,l.PL)(a);return r.docs.map(t=>{let e=t.data();return{album:e.album,album_id:e.album_id,album_title:e.album_title,artist_id:e.artist_id,artist_name:e.artist_name,creators:e.creators,flac_info:e.flac_info,genre:e.genre,hearts:e.hearts,listeners:e.listeners,lyrics:e.lyrics,related_videos:e.related_videos,release_date:e.release_date,released_date:e.released_date,song_id:e.song_id,song_title:e.song_title,spotify_album_image_url:e.spotify_album_image_url,spotify_album_name:e.spotify_album_name,spotify_album_release_date:e.spotify_album_release_date,spotify_album_total_tracks:e.spotify_album_total_tracks,spotify_album_url:e.spotify_album_url,spotify_artists:e.spotify_artists,spotify_audio_features:e.spotify_audio_features,spotify_id:e.spotify_id,spotify_isrc:e.spotify_isrc,spotify_popularity:e.spotify_popularity,spotify_preview_url:e.spotify_preview_url,spotify_track_duration_ms:e.spotify_track_duration_ms,spotify_track_name:e.spotify_track_name,spotify_track_number:e.spotify_track_number,spotify_track_url:e.spotify_track_url,streams:e.streams,timestamp:e.timestamp}})};var d=a(46618),_=t=>{let{data:e,features:a,width:l,height:i}=t,n=(0,s.useRef)(null),o=t=>({acousticness:"자연음향",danceability:"리듬감",energy:"강렬함",liveness:"현장감",speechiness:"음성비중",valence:"감성적온도"})[t]||t;return(0,s.useEffect)(()=>{if(!e||0===e.length)return;d.Ys(n.current).selectAll("*").remove();let t={top:50,right:100,bottom:50,left:100},r=l-t.left-t.right,s=i-t.top-t.bottom,c=Math.min(r,s)/2,m=d.Ys(n.current).attr("width",l).attr("height",i),u=m.append("g").attr("transform","translate(".concat(t.left+r/2,",").concat(t.top+s/2,")")),_=2*Math.PI/a.length,p=d.BYU().domain([0,1]).range([0,c]),f=a.map(t=>o(t));for(let t=1;t<=5;t++){let e=c/5*t;u.selectAll(".levels").data(f).enter().append("line").attr("x1",(t,a)=>e*Math.cos(_*a-Math.PI/2)).attr("y1",(t,a)=>e*Math.sin(_*a-Math.PI/2)).attr("x2",(t,a)=>e*Math.cos(_*(a+1)-Math.PI/2)).attr("y2",(t,a)=>e*Math.sin(_*(a+1)-Math.PI/2)).attr("class","line").style("stroke","gray").style("stroke-opacity","0.75").style("stroke-width","0.3px").attr("transform","rotate(0)")}let h=u.selectAll(".axis").data(f).enter().append("g").attr("class","axis");h.append("line").attr("x1",0).attr("y1",0).attr("x2",(t,e)=>p(1.1)*Math.cos(_*e-Math.PI/2)).attr("y2",(t,e)=>p(1.1)*Math.sin(_*e-Math.PI/2)).attr("class","line").style("stroke","gray").style("stroke-width","1px"),h.append("text").attr("x",(t,e)=>p(1.25)*Math.cos(_*e-Math.PI/2)).attr("y",(t,e)=>p(1.25)*Math.sin(_*e-Math.PI/2)).attr("class","legend").style("font-size","12px").attr("text-anchor","middle").attr("dy","0.35em").text(t=>t.charAt(0).toUpperCase()+t.slice(1));let g=d.jvg().x(t=>p(t.value)*Math.cos(_*t.index-Math.PI/2)).y(t=>p(t.value)*Math.sin(_*t.index-Math.PI/2)).curve(d.fxm);e.forEach((t,e)=>{let r=a.map((e,a)=>({value:t.values[e],index:a}));u.append("path").datum(r).attr("d",g).style("stroke-width","2px").style("stroke",0===e?"#ff7300":"#8884d8").style("fill",0===e?"#ff7300":"#8884d8").style("fill-opacity",.1).on("mouseover",function(){d.Ys(this).style("fill-opacity",.3)}).on("mouseout",function(){d.Ys(this).style("fill-opacity",.1)})});let y=m.append("g").attr("transform","translate(".concat(l-t.right+20,", ").concat(t.top,")"));e.forEach((t,e)=>{let a=y.append("g").attr("transform","translate(0, ".concat(20*e,")"));a.append("rect").attr("width",10).attr("height",10).attr("fill",0===e?"#ff7300":"#8884d8"),a.append("text").attr("x",15).attr("y",10).attr("text-anchor","start").style("font-size","12px").text(t.label)})},[e,a,l,i]),(0,r.jsx)("div",{className:"w-full overflow-x-auto",children:(0,r.jsx)("svg",{ref:n})})},p=a(8411),f=a(44421);let h=["acousticness","danceability","energy","liveness","speechiness","valence"];var g=t=>{let{data:e,yKey:a,width:l,height:i}=t,n=(0,s.useRef)(null),[o,c]=(0,s.useState)("energy"),m=(0,s.useRef)(null),u=(0,s.useCallback)(()=>{m.current=setInterval(()=>{c(t=>{let e=h.indexOf(t),a=(e+1)%h.length;return h[a]})},1e4)},[]);(0,s.useEffect)(()=>(u(),()=>{m.current&&clearInterval(m.current)}),[u]);let _=t=>{c(t),m.current&&clearInterval(m.current),u()};(0,s.useEffect)(()=>{if(!e||0===e.length)return;let t=e.map(t=>({...t,log_streaming_count:t.streaming_count>0?Math.log10(t.streaming_count):0})),a=d.Fp7(t,t=>t.log_streaming_count)||1,r=d.VV$(t,t=>t.log_streaming_count)||0,s=t.map(t=>({...t,normalized_streaming_count:(t.log_streaming_count-r)/(a-r)})),c=d.Ys(n.current).attr("width",l).attr("height",i).attr("viewBox","0 0 ".concat(l," ").concat(i)).attr("preserveAspectRatio","xMidYMid meet");c.selectAll("*").remove();let m={top:20,right:70,bottom:20,left:70},u=l-m.left-m.right,_=i-m.top-m.bottom,h=c.append("g").attr("transform","translate(".concat(m.left,",").concat(m.top,")")),y=d.BYU().domain([0,1.1*d.Fp7(s,t=>t[o])]).range([0,u]),x=d.BYU().domain([0,1]).range([_,0]),b=d.cJy(d.sY$).domain([0,d.Fp7(s,t=>t.normalized_streaming_count)]),v=d.BYU().domain([d.VV$(s,t=>t.normalized_streaming_count)||0,d.Fp7(s,t=>t.normalized_streaming_count)||1]).range([.2,.7]),k=d.LLu(y).ticks(6).tickSizeOuter(0),j=d.y4O(x).ticks(6).tickSizeOuter(0).tickFormat(d.WUZ(".0%")),w=h.append("g").attr("transform","translate(0, ".concat(_,")")).call(k);w.append("text").attr("x",u/2).attr("y",35).attr("fill","currentColor").attr("text-anchor","middle").attr("font-size","12px").text("".concat(g(o)));let N=h.append("g").call(j);N.append("text").attr("transform","rotate(-90)").attr("x",-_/2).attr("y",-50).attr("fill","currentColor").attr("text-anchor","middle").attr("font-size","12px").text("스트리밍 횟수 (정규화)");let S=d.Ys("body").append("div").attr("class","tooltip").style("position","absolute").style("background","white").style("border","1px solid #ccc").style("border-radius","4px").style("padding","8px").style("pointer-events","none").style("opacity",0).style("box-shadow","0px 0px 10px rgba(0,0,0,0.1)"),z=h.selectAll("circle").data(s).enter().append("circle").attr("cx",t=>y(t[o])).attr("cy",t=>x(t.normalized_streaming_count)).attr("r",0).attr("fill",t=>d.sY$(t.normalized_streaming_count)).attr("opacity",t=>t.normalized_streaming_count).on("mouseover",(t,e)=>{S.style("opacity",1).html("\n                        ".concat(e.artist," - ").concat(e.song,"<br/>\n                        ").concat(g(o),": ").concat(e[o].toFixed(2),"<br/>\n                        스트리밍 횟수: ").concat(e.streaming_count.toLocaleString(),"회\n                    ")).style("left","".concat(t.pageX+10,"px")).style("top","".concat(t.pageY-28,"px"))}).on("mouseout",()=>{S.style("opacity",0)});z.transition().duration(500).attr("r",8);let C=p(s.map(t=>t[o]),s.map(t=>t.normalized_streaming_count)),E=[{x:d.VV$(s,t=>t[o]),y:C.intercept+C.slope*d.VV$(s,t=>t[o])},{x:d.Fp7(s,t=>t[o]),y:C.intercept+C.slope*d.Fp7(s,t=>t[o])}],P=d.jvg().x(t=>y(t.x)).y(t=>x(t.y));h.append("path").datum(E).attr("class","regression-line").attr("d",P).style("stroke","#7c848e").style("stroke-width","1px").style("fill","none").attr("stroke-dasharray","5,5").transition().duration(1e3).style("stroke-width","3px").attr("stroke-dasharray",null);let M=f(s.map(t=>t[o]),s.map(t=>t.normalized_streaming_count));h.append("text").enter().attr("class","correlation-text").attr("x",u-10).attr("y",_-10).attr("text-anchor","end").attr("fill","black").attr("font-size","8px").text("상관계수: ".concat(M.toFixed(2))).style("opacity",0).transition().duration(1e3).style("opacity",1),y.domain([0,1.1*d.Fp7(s,t=>t[o])]),w.transition().duration(1e3).call(k),N.transition().duration(1e3).call(j),w.select("text").transition().duration(1e3).text("".concat(g(o))),b.domain([0,d.Fp7(s,t=>t.streaming_count)]),v.domain([r,a]),h.selectAll("circle").data(s).transition().duration(800).attr("cx",t=>y(t[o])).attr("cy",t=>x(t.normalized_streaming_count)).attr("fill",t=>d.sY$(t.normalized_streaming_count)).attr("opacity",t=>t.normalized_streaming_count).attr("r",6);let I=p(s.map(t=>t[o]),s.map(t=>t.normalized_streaming_count)),R=[{x:d.VV$(s,t=>t[o]),y:I.intercept+I.slope*d.VV$(s,t=>t[o])},{x:d.Fp7(s,t=>t[o]),y:I.intercept+I.slope*d.Fp7(s,t=>t[o])}];h.selectAll(".regression-line").datum(R).transition().duration(1e3).attr("d",P);let F=f(s.map(t=>t[o]),s.map(t=>t.normalized_streaming_count));return console.log("Updated Correlation:",F),h.selectAll(".correlation-text").text("상관계수: ".concat(F.toFixed(2))),()=>{S.remove()}},[e,o,a,l,i]);let p=(t,e)=>{let a=t.length,r=d.Smz(t),s=d.Smz(e),l=d.Smz(t.map((t,a)=>t*e[a])),i=d.Smz(t.map(t=>t*t)),n=(a*l-r*s)/(a*i-r*r);return{slope:n,intercept:(s-n*r)/a}},f=(t,e)=>{let a=t.length,r=d.Smz(t),s=d.Smz(e),l=d.Smz(t.map((t,a)=>t*e[a])),i=d.Smz(t.map(t=>t*t)),n=d.Smz(e.map(t=>t*t)),o=Math.sqrt((a*i-r*r)*(a*n-s*s));return 0!==o?(a*l-r*s)/o:0},g=t=>({acousticness:"자연음향",danceability:"리듬감",energy:"강렬함",liveness:"현장감",speechiness:"음성비중",valence:"감성적 온도"})[t]||t;return(0,r.jsxs)("div",{className:"w-full flex flex-col items-center relative",children:[(0,r.jsx)("svg",{ref:n,width:l,height:i}),(0,r.jsx)("div",{className:"flex justify-center mt-4 space-x-2",children:h.map(t=>(0,r.jsx)("button",{onClick:()=>_(t),className:"w-4 h-4 rounded-full border-2 ".concat(o===t?"bg-gray-500":"bg-gray-100"," focus:outline-none"),"aria-label":g(t)},t))})]})},y=t=>{let{melon_artist_id:e,circlechart_data:a}=t,[l,i]=(0,s.useState)([]),[n,o]=(0,s.useState)([]),[c]=(0,s.useState)(["acousticness","danceability","energy","liveness","speechiness","valence"]),[d,h]=(0,s.useState)([]),[y,x]=(0,s.useState)([]),[b,v]=(0,s.useState)(!0),[k,j]=(0,s.useState)(null),w=(0,s.useMemo)(()=>[...a.global_chart,...a.streaming_chart,...a.retail_chart].filter(t=>t.melon_album_id).map(t=>t.melon_album_id),[a]);(0,s.useEffect)(()=>{let t=async()=>{try{v(!0),j(null);let t=await m(e);i(t);let a=new Set;t.forEach(t=>{t.genre.forEach(t=>a.add(t))});let r=await Promise.all(w.map(t=>u(t))),s=r.flat(),l=s.filter(t=>t.genre.some(t=>a.has(t)));console.log("targetGenres",a),console.log("filteredSongs : ",l),o(l)}catch(t){console.error("데이터를 가져오는 중 오류 발생:",t),j("데이터를 가져오는 중 오류가 발생했습니다.")}finally{v(!1)}};t()},[e,w]);let N=t=>{let e={};c.forEach(t=>{e[t]=0}),t.forEach(t=>{c.forEach(a=>{var r;let s=null===(r=t.spotify_audio_features)||void 0===r?void 0:r[a];e[a]+="number"==typeof s?s:0})});let a={};return c.forEach(r=>{a[r]=t.length>0?e[r]/t.length:0}),a};return((0,s.useEffect)(()=>{if(l.length>0&&n.length>0){let t=N(l),e=N(n),a=[{label:l[0].artist_name,values:t},{label:"장르 평균",values:e}];h(a)}else h([])},[l,n,c]),(0,s.useEffect)(()=>{if(n.length>0){let t=n.map(t=>({energy:t.spotify_audio_features.energy,danceability:t.spotify_audio_features.danceability,acousticness:t.spotify_audio_features.acousticness,liveness:t.spotify_audio_features.liveness,speechiness:t.spotify_audio_features.speechiness,valence:t.spotify_audio_features.valence,streaming_count:t.streams,artist:t.artist_name,song:t.song_title})).filter(t=>void 0!==t.streaming_count&&null!==t.streaming_count);x(t)}else x([])},[n]),b)?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(p.Z,{})}):k?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(f.Z,{message:k})}):(0,r.jsx)("div",{className:"audio-features-comparison p-1 space-y-12 max-w-7xl mx-auto",children:(0,r.jsx)("section",{children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row justify-around items-center space-y-4 lg:space-y-0 lg:space-x-0 mx-auto",children:[(0,r.jsx)("div",{className:"w-full lg:w-1/2 p-1 rounded-lg",children:(0,r.jsx)(_,{data:d,features:c,width:500,height:400})}),(0,r.jsx)("div",{className:"w-full lg:w-1/2 p-1 rounded-lg",children:(0,r.jsx)(g,{data:y,yKey:"streaming_count",width:500,height:400},"energy")})]})})})},x=a(3466),b=a(55592),v=a(83574),k=a(83143),j=a(24033),w=()=>{let[t,e]=(0,s.useState)(null),[a,l]=(0,s.useState)(!0),[i,n]=(0,s.useState)(void 0),[m,u]=(0,s.useState)(void 0),d=(0,j.useParams)(),_=(0,j.useRouter)(),{report:h,error:g,getReportByArtistEng:w,setReport:N}=(0,v.useReportContext)(),S=d.artist_eng,z="string"==typeof S?S:void 0;return((0,s.useEffect)(()=>{if(console.log(z),!z){_.push("/404");return}let t=async()=>{if(h)w(z),n(h.circlechart_target||void 0),u(h.melon_artist_id||void 0);else try{let t=await (0,k.Th)(z);t?(N(t),n(t.circlechart_target||void 0),u(t.melon_artist_id||void 0)):_.push("/404")}catch(t){console.error("Failed to fetch report:",t)}};t()},[z,h,w,_,N]),(0,s.useEffect)(()=>{let t=async()=>{if(!i)return;l(!0);let t=await o(i);e(t),l(!1)};t()},[i]),a)?(0,r.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,r.jsx)(p.Z,{})}):(0,r.jsx)("div",{className:"p-6",children:t&&i&&m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c,{target:i,global:t.global_chart,streaming:t.streaming_chart,retail:t.retail_chart}),(0,r.jsx)(x.Z,{opacity:.5,marginTop:"1rem",marginBottom:"1rem",color:"blue-500"}),(0,r.jsx)(y,{melon_artist_id:m,circlechart_data:t}),(0,r.jsx)(b.Z,{commentKey:"meso_circlechart_comment"})]}):(0,r.jsx)(f.Z,{message:"CircleChart 데이터를 찾을 수 없습니다."})})}},55592:function(t,e,a){var r=a(57437),s=a(2265),l=a(83574);e.Z=t=>{let{commentKey:e}=t,{report:a,updateReportFieldInContext:i}=(0,l.useReportContext)(),[n,o]=(0,s.useState)(!1),[c,m]=(0,s.useState)(""),u=(0,s.useRef)(null);(0,s.useEffect)(()=>{a&&a[e]&&m(a[e])},[a,e]);let d=async()=>{i(e,c),o(!1)};return(0,r.jsx)("div",{className:"mt-4",children:c||n?n?(0,r.jsxs)("div",{children:[(0,r.jsx)("textarea",{className:"w-full h-32 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:c,onChange:t=>m(t.target.value)}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 mt-2",children:[(0,r.jsx)("button",{onClick:()=>{m(a?a[e]:""),o(!1)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors",children:"취소"}),(0,r.jsx)("button",{onClick:d,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"저장"})]})]}):(0,r.jsx)("p",{ref:u,tabIndex:0,className:"text-base text-gray-700 cursor-pointer focus:outline-none",onDoubleClick:()=>o(!0),children:c}):(0,r.jsx)("button",{onClick:()=>o(!0),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"코멘트 추가"})})}},3466:function(t,e,a){var r=a(57437);a(2265),e.Z=t=>{let{opacity:e=1,marginTop:a="1rem",marginBottom:s="1rem",color:l="gray-300"}=t;return(0,r.jsx)("hr",{style:{opacity:e,marginTop:a,marginBottom:s},className:"border-t border-".concat(l)})}},44421:function(t,e,a){var r=a(57437);a(2265),e.Z=t=>{let{message:e}=t;return(0,r.jsx)("div",{className:"flex items-center space-x-2 text-red-600",children:(0,r.jsx)("span",{children:e})})}},8411:function(t,e,a){var r=a(57437);a(2265),e.Z=()=>(0,r.jsx)("div",{className:"loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-32 w-32"})},83574:function(t,e,a){a.r(e),a.d(e,{ReportProvider:function(){return n},useReportContext:function(){return o}});var r=a(57437),s=a(2265),l=a(83143);let i=(0,s.createContext)(void 0),n=t=>{let{children:e}=t,[a,n]=(0,s.useState)([]),[o,c]=(0,s.useState)(null),[m,u]=(0,s.useState)(!0),[d,_]=(0,s.useState)(null);(0,s.useEffect)(()=>{let t=async()=>{try{let t=await (0,l.U9)();n(t)}catch(e){let t=e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다.";_(t)}finally{u(!1)}};t()},[]);let p=async t=>{u(!0);try{let e=a.find(e=>e.artist_eng===t);e?c(e):(_("해당 리포트를 찾을 수 없습니다."),c(null))}catch(e){let t=e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다.";_(t)}finally{u(!1)}},f=async(t,e)=>{if(o){let a={...o,[t]:e};c(a),await (0,l.Y8)(o.artist_eng,t,e)}};return(0,r.jsx)(i.Provider,{value:{reports:a,report:o,loading:m,error:d,getReportByArtistEng:p,updateReportFieldInContext:f,setReport:c},children:e})},o=()=>{let t=(0,s.useContext)(i);if(!t)throw Error("useReportContext must be used within a ReportProvider");return t}},72420:function(t,e,a){a.d(e,{db:function(){return n},t:function(){return o}});var r=a(20994),s=a(24086),l=a(69584);let i=(0,r.ZF)({apiKey:"AIzaSyCDkyA_EzL99SjudTHAYTwdFi6P--bn5HI",authDomain:"redslippers.firebaseapp.com",projectId:"redslippers",storageBucket:"redslippers.appspot.com",messagingSenderId:"263516861210",appId:"1:263516861210:web:5982131662655b0c32b2a3"}),n=(0,s.ad)(i),o=(0,l.cF)(i)},83143:function(t,e,a){a.d(e,{Th:function(){return l},U9:function(){return i},Y8:function(){return n}});var r=a(24086),s=a(72420);let l=async t=>{let e=(0,r.hJ)(s.db,"Report"),a=await (0,r.PL)(e),l=null;return a.forEach(e=>{let a=e.data();if(a.artist_eng===t){var r;l={id:e.id,artist_eng:a.artist_eng,artist_kor:a.artist_kor,title:a.title,sub_title:a.sub_title,image_alpha:a.image_alpha,background:a.background||null,gallery:a.gallery||null,macro_marketGrowth_comment:a.macro_marketGrowth_comment||null,macro_marketGrowthDetail_comment:a.macro_marketGrowthDetail_comment||null,circlechart_target:a.circlechart_target||null,melon_artist_id:a.melon_artist_id||null,meso_circlechart_comment:a.meso_circlechart_comment||null,micro:{pastSections:(null===(r=a.micro)||void 0===r?void 0:r.pastSections)||[]}}}}),l},i=async()=>{let t=(0,r.hJ)(s.db,"Report"),e=await (0,r.PL)(t),a=[];return e.forEach(t=>{var e;let r=t.data();a.push({id:t.id,artist_eng:r.artist_eng||"",artist_kor:r.artist_kor||"",title:r.title||"IPO REPORT",sub_title:r.sub_title||"IPO 리포트",image_alpha:r.image_alpha||"",background:r.background||null,gallery:r.gallery||null,macro_marketGrowth_comment:r.macro_marketGrowth_comment||null,macro_marketGrowthDetail_comment:r.macro_marketGrowthDetail_comment||null,circlechart_target:r.circlechart_target||null,melon_artist_id:r.melon_artist_id||null,meso_circlechart_comment:r.meso_circlechart_comment||null,micro:{pastSections:(null===(e=r.micro)||void 0===e?void 0:e.pastSections)||[]}})}),a},n=async(t,e,a)=>{let l=(0,r.hJ)(s.db,"Report"),i=await (0,r.PL)(l),n=null;if(i.forEach(e=>{let a=e.data();a.artist_eng===t&&(n=e.id)}),n){let t=(0,r.JU)(s.db,"Report",n);await (0,r.r7)(t,{[e]:a})}else throw Error("Report not found")}}}]);